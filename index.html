<html><head><title>E1M1</title>
<script src="https://cdn.rawgit.com/mrdoob/three.js/r74/build/three.min.js"></script>
<script src="https://cdn.rawgit.com/Ooblik/AltspaceVR-Native-Components-JS/master/js/JSNativeComponents.js"></script>
<script src="https://cdn.rawgit.com/norybiak/UltimateLoader/master/dist/UltimateLoader.min.js"></script>
<script src="dist/altspace.min.js"></script>
</head><body><script>

// https://rawgit.com/evil-doer/evil-doer.github.io/master/

var sim = altspace.utilities.Simulation();
var goingup1 = goingup2 = goingup3 = goingup4 = PlayUp = PlayDown = true;
var root = new THREE.Object3D();
var slime;
var timer = new Date().getTime();
var frame = 1;
var angle = 0;
var e1m1Group;
var door1 = new THREE.Object3D();
var actualDoor1 = new THREE.Object3D();
var door2 = new THREE.Object3D();
var actualDoor2 = new THREE.Object3D();
var door3 = new THREE.Object3D();
var actualDoor3 = new THREE.Object3D();
var door4 = new THREE.Object3D();
var actualDoor4 = new THREE.Object3D();
sim.scene.add(root);
var config = { authorId: "evildoer", appId: "E1M1", baseRefUrl: "https://altspace-73900.firebaseio.com/"};

	
(function holdingBox(){
	var done = false;
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/elevator.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.children[0].material.opacity = 0.3;
		obj.children[0].material.transparent = true;
		elevator = obj;
		sim.scene.add(elevator);
	});
	function animate(){
		requestAnimationFrame(animate);
		THREE.DefaultLoadingManager.onProgress = function (item, loaded, total) {
			if(loaded == 2){
				main();
				done = true;
			};
		};
	};
	animate();
	if(done)return;
})();


function main(){

	altspace.utilities.sync.connect(config).then(function(connection) {
		sceneSync = altspace.utilities.behaviors.SceneSync(connection.instance, {
			instantiators: {"door1Trigger": door1Trigger, "door2Trigger": door2Trigger,
			"door3Trigger": door3Trigger, "door4Trigger": door4Trigger }, ready: ready
		});
		sim.scene.addBehavior(sceneSync);
	});
	
	function ready(firstInstance){
		if(firstInstance){
			sceneSync.instantiate("door1Trigger");
			sceneSync.instantiate("door2Trigger");
			sceneSync.instantiate("door3Trigger");
			sceneSync.instantiate("door4Trigger");
		};
	};


	altspace.getThreeJSTrackingSkeleton().then(function(skeleton){
		sim.scene.add(skeleton);
		headTrack = skeleton.getJoint("Head");
	});
	
	// SKY SPHERE
	var loader = new THREE.TextureLoader();
	loader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/SKY1.png", function(texture){
		var geometry = new THREE.SphereGeometry(2000, 32, 32); 
		var material = new THREE.MeshBasicMaterial({map: texture, side: THREE.BackSide});
		sky = new THREE.Mesh(geometry, material);
		sim.scene.add(sky);
	});
	
	// MAIN LEVEL
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/e1m1.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.traverse(function(child){
			child.userData.altspace = {collider:{enabled: false}}; //CURSOR REMOVAL
	
			if(child.name =="Object__218"){
				endGlowFloor = child.material.clone();
				child.material = endGlowFloor;
			}
			if(child.name =="Object__220"){
				endGlowWalls = child.material.clone();
				child.material = endGlowWalls;
			}
			if(child.name =="Object__219"){
				endGlowCeiling = child.material.clone();
				child.material = endGlowCeiling;
			}
			if(child.name =="Object__221"){
				fence = child.material.clone();
				child.material = fence;
				fence.transparent = true;
			}
			if(child.name =="Object__122"){
				leftColFloor = child.material.clone();
				child.material = leftColFloor;
			}
			if(child.name =="Object__123"){
				leftColCeiling = child.material.clone();
				child.material = leftColCeiling;
			}
			if(child.name =="Object__124"){
				rightColFloor = child.material.clone();
				child.material = rightColFloor;
			}
			if(child.name =="Object__125"){
				rightColCeiling = child.material.clone();
				child.material = rightColCeiling;
			}
			if(child.name =="Object__99"){
				spawnFloor = child.material.clone();
				child.material = spawnFloor;
			}
			if(child.name =="Object__102"){
				spawnWalls = child.material.clone();
				child.material = spawnWalls;
			}
			if(child.name =="Object__101"){
				spawnDoor = child.material.clone();
				child.material = spawnDoor;
			}
			if(child.name =="Object__100"){
				spawnCeiling = child.material.clone();
				child.material = spawnCeiling;
			}
			if(child.name =="Object__140"){
				spinnyThing = child.material.clone();
				child.material = spinnyThing;
			}
		});
		e1m1Group = obj;
		sim.scene.add(e1m1Group);
		darken();
	});
	
	//DARKEN SECTORS
	function darken(){
		var array = [[139, 192],[137,192],[142,192],[141,192],[157,176],[160,176],[159,176],[111,128],[109,128],[163,144],[161,144],[132,144],
			[129,144],[126,144],[119,144],[116,144],[113,128],[134,144],[131,144],[128,144],[121,144],[118,144],[112,144],[103,128],[105,128],
			[107,128],[108,128],[95,144],[98,144],[97,144],[85,224],[88,224],[87,224],[89,224],[90,192],[93,192],[94,192],[79,144],[81,144],
			[72,160],[74,160],[46,128],[52,128],[48,128],[49,128],[51,128],[50,128],[208,160],[210,160],[211,160],[169,160],[171,160],
			[164,144],[167,144],[168,144],[166,144],[190,192],[192,192],[182,192],[181,192],[195,192],[175,144],[176,144],[178,144],[187,160],
			[189,160],[280,128],[282,128],[299,128],[279,128],[298,128],[277,128],[224,128],[226,128],[296,144],[296,144],[260,128],[263,128],
			[265,128],[262,128],[257,128],[259,128],[254,128],[256,128],[251,128],[253,128],[248,128],[250,128],[274,128],[276,128],[270,128],
			[273,128],[272,128],[17,128],[17,128],[19,128],[20,128],[21,128],[23,128],[24,128],[26,128],[27,128],[29,128],[30,128],[32,128],[38,176],
			[41,176],[40,176],[138,192],[150,192],[140,192],[149,192],[158,176],[110,128],[162,144],[133,144],[130,144],[120,144],[127,144],
			[117,144],[104,128],[96,144],[86,192],[80,144],[73,160],[47,128],[209,160],[170,160],[165,144],[191,192],[194,192],[180,192],
			[173,144],[177,144],[188,160],[178,128],[181,128],[225,128],[264,128],[261,128],[258,128],[255,128],[252,128],[275,128],[249,128],
			[271,128],[18,128],[22,128],[25,128],[28,128],[31,128],[39,176],[114,128],[115,128],[197,144],[174,144]];
	
		for(i=0; i < array.length; i++){
			e1m1Group.traverse(function(child){	
				if(child.name == "Object__" + array[i][0]){
					array[i][0] = child.material.clone();
					child.material = array[i][0];
					array[i][0].color = new THREE.Color(array[i][1]/256, array[i][1]/256, array[i][1]/256);
				};
			});
		}
	};
	
	//SLIME LAYER
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/slime.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.traverse(function(child){
			child.userData.altspace = {collider:{enabled: false}};
		});
		obj.children[0].material.map.repeat.x = 1/3;
		obj.position.y = 0.2;
		slime=obj;
		sim.scene.add(slime);
	});
	
	// DOOR 1 TRIGGER
	function door1Trigger(){
		var geometry = new THREE.BoxGeometry(0.7128, 3.92445, 5.7078); // original 0.528, 2.907, 4.228 - multiply by 1.35 to be clickable
		var material = new THREE.MeshBasicMaterial({transparent: true, opacity: 0});
		door1 = new THREE.Mesh(geometry, material);
		door1.position.set(16.12228, 6.48208, -37.43868);
		door1.addBehaviors(altspace.utilities.behaviors.Object3DSync(), doorAction1() );
		door1UpSound = new NativeComponent('n-sound', {src: "DoorUp.ogg", oneshot: true, minDistance: 3}).addTo(door1);
		door1DownSound = new NativeComponent('n-sound', {src: "DoorDown.ogg", oneshot: true, minDistance: 3}).addTo(door1);
		sim.scene.add(door1);
		return(door1);
	};
	//DOOR 1 OBJ
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/door1.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.position.set(-16.12228, -6.48208, 37.43868);
		obj.children[0].material.color = new THREE.Color(208/256, 208/256, 208/256);
		obj.children[1].material.color = new THREE.Color(208/256, 208/256, 208/256);
		actualDoor1 = obj;
	});
	// DOOR 1 ACTION
	function doorAction1(){
		function awake(object3d){
		
			object3d.add(actualDoor1);
			var sync = object3d.getBehaviorByType('Object3DSync'); 
			
			direction1 = sync.dataRef.child("direction1");
			soundDown1 = sync.dataRef.child("soundDown1");
			soundUp1 = sync.dataRef.child("soundUp1");

			direction1.on("value", function(snapshot){
				direction1Val = snapshot.val();
				
				doorLoop();
				
				function doorLoop(){
					if (!direction1Val || direction1Val=="top" || direction1Val=="bottom")return;
					if(direction1Val == "up"){
						soundDown1.set("stopped");
						door1DownSound.call("stop");
						soundUp1.on("value", function(snap){soundUp1Val = snap.val()});
						if(soundUp1Val == "stopped" || !soundUp1Val){
							door1UpSound.call("play");
							soundUp1.set("playing");
						};
						door1.position.y += 0.05;
						if(door1.position.y >= 8.7){
							soundUp1.set("stopped");
							direction1.set("top");
							return;
						};
					};
					
					if(direction1Val == "down"){
						soundUp1.set("stopped");
						door1UpSound.call("stop");
						soundDown1.on("value", function(snap){soundDown1Val = snap.val()});
						if(soundDown1Val == "stopped"){
							door1DownSound.call("play"); 
							soundDown1.set("playing");
						};
						door1.position.y -= 0.05;
						if(door1.position.y <= 6.53208){
							soundDown1.set("stopped");
							direction1.set("bottom");
							return;
						};
						
					};
					requestAnimationFrame(doorLoop);
				};
			});
			
			object3d.addEventListener("cursordown", function(){
				if(direction1Val == "up" ||direction1Val == "top"){
					direction1.set("down");
				}else if(!direction1Val || direction1Val == "down" || direction1Val == "bottom"){
					direction1.set("up");
				};
			});
		};
		
		return {awake: awake};
	};
	
	// DOOR 2 TRIGGER
	function door2Trigger(){
		var geometry = new THREE.BoxGeometry(1.42695, 8.91945, 5.7078); // original 1.057 6.607 4.228 - multiply by 1.35 to be clickable
		var material = new THREE.MeshBasicMaterial({transparent: true, opacity: 0});
		door2 = new THREE.Mesh(geometry, material);
		door2.position.set(61.84377, 7.5391, 6.96133);
		door2.addBehaviors(altspace.utilities.behaviors.Object3DSync(), doorAction2() );
		door2UpSound = new NativeComponent('n-sound', {src: "DoorUp.ogg", oneshot: true, minDistance: 3}).addTo(door2);
		door2DownSound = new NativeComponent('n-sound', {src: "DoorDown.ogg", oneshot: true, minDistance: 3}).addTo(door2);
		sim.scene.add(door2);
		return(door2);
	};
	//DOOR 2 OBJ
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/door2.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.position.set(-61.84377, -7.5391, -6.96133);
		obj.children[0].material.color = new THREE.Color(144/256, 144/256, 144/256);
		obj.children[1].material.color = new THREE.Color(144/256, 144/256, 144/256);
		actualDoor2 = obj;
	});
	// DOOR 2 ACTION
	function doorAction2(){
		function awake(object3d){
		
			object3d.add(actualDoor2);
			var sync = object3d.getBehaviorByType('Object3DSync'); 
			
			direction2 = sync.dataRef.child("direction2");
			soundDown2 = sync.dataRef.child("soundDown2");
			soundUp2 = sync.dataRef.child("soundUp2");

			direction2.on("value", function(snapshot){
				direction2Val = snapshot.val();
				
				doorLoop();
				
				function doorLoop(){
					if (!direction2Val || direction2Val=="top" || direction2Val=="bottom")return;
					if(direction2Val == "up"){
						soundDown2.set("stopped");
						door2DownSound.call("stop");
						soundUp2.on("value", function(snap){soundUp2Val = snap.val()});
						if(soundUp2Val == "stopped" || !soundUp1Val){
							door2UpSound.call("play");
							soundUp2.set("playing");
						};
						door2.position.y += 0.05;
						if(door2.position.y >= 9.7391){
							soundUp2.set("stopped");
							direction2.set("top");
							return;
						};
					};
					
					if(direction2Val == "down"){
						soundUp2.set("stopped");
						door2UpSound.call("stop");
						soundDown2.on("value", function(snap){soundDown2Val = snap.val()});
						if(soundDown2Val == "stopped"){
							door2DownSound.call("play"); 
							soundDown2.set("playing");
						};
						door2.position.y -= 0.05;
						if(door2.position.y <= 7.5891){
							soundDown2.set("stopped");
							direction2.set("bottom");
							return;
						};
						
					};
					requestAnimationFrame(doorLoop);
				};
			});
			
			object3d.addEventListener("cursordown", function(){
				if(direction2Val == "up" ||direction2Val == "top"){
					direction2.set("down");
				}else if(!direction2Val || direction2Val == "down" || direction2Val == "bottom"){
					direction2.set("up");
				};
			});
		};
		
		return {awake: awake};
	};
	
	// DOOR 3 TRIGGER
	function door3Trigger(){	
		var geometry = new THREE.BoxGeometry(5.70915, 3.21165, 0.71415); // original 4.229 2.379 0.529 - multiply by 1.35 to be clickable
		var material = new THREE.MeshBasicMaterial({transparent: true, opacity: 0});
		door3 = new THREE.Mesh(geometry, material);
		door3.position.set(64.48676, 5.4251, 13.03983);
		door3.addBehaviors(altspace.utilities.behaviors.Object3DSync(), doorAction3() );
		door3UpSound = new NativeComponent('n-sound', {src: "DoorUp.ogg", oneshot: true, minDistance: 3}).addTo(door3);
		door3DownSound = new NativeComponent('n-sound', {src: "DoorDown.ogg", oneshot: true, minDistance: 3}).addTo(door3);
		sim.scene.add(door3);
		return(door3);
	};	
	//DOOR 3 OBJ
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/door3.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.position.set(-64.48676, -5.4251, -13.03983);
		obj.children[0].material.color = new THREE.Color(228/256, 228/256, 228/256);
		obj.children[1].material.color = new THREE.Color(228/256, 228/256, 228/256);
		actualDoor3 = obj;
	});
	// DOOR 3 ACTION
	function doorAction3(){
		function awake(object3d){
		
			object3d.add(actualDoor3);
			var sync = object3d.getBehaviorByType('Object3DSync'); 
			
			direction3 = sync.dataRef.child("direction3");
			soundDown3 = sync.dataRef.child("soundDown3");
			soundUp3 = sync.dataRef.child("soundUp3");

			direction3.on("value", function(snapshot){
				direction3Val = snapshot.val();
				
				doorLoop();
				
				function doorLoop(){
					if (!direction3Val || direction3Val=="top" || direction3Val=="bottom")return;
					if(direction3Val == "up"){
						soundDown3.set("stopped");
						door3DownSound.call("stop");
						soundUp3.on("value", function(snap){soundUp3Val = snap.val()});
						if(soundUp3Val == "stopped" || !soundUp3Val){
							door3UpSound.call("play");
							soundUp3.set("playing");
						};
						door3.position.y += 0.05;
						if(door3.position.y >= 7.6251){
							soundUp3.set("stopped");
							direction3.set("top");
							return;
						};
					};
					
					if(direction3Val == "down"){
						soundUp3.set("stopped");
						door3UpSound.call("stop");
						soundDown3.on("value", function(snap){soundDown3Val = snap.val()});
						if(soundDown3Val == "stopped"){
							door3DownSound.call("play"); 
							soundDown3.set("playing");
						};
						door3.position.y -= 0.05;
						if(door3.position.y <= 5.4751){
							soundDown3.set("stopped");
							direction3.set("bottom");
							return;
						};
						
					};
					requestAnimationFrame(doorLoop);
				};
			});
			
			object3d.addEventListener("cursordown", function(){
				if(direction3Val == "up" ||direction3Val == "top"){
					direction3.set("down");
				}else if(!direction3Val || direction3Val == "down" || direction3Val == "bottom"){
					direction3.set("up");
				};
			});
		};
		
		return {awake: awake};
	};
	
	// DOOR 4 TRIGGER
	function door4Trigger(){	
		var geometry = new THREE.BoxGeometry(2.85525, 3.21165, 0.71415); // original 2.115 2.379 0.529 - multiply by 1.35 to be clickable
		var material = new THREE.MeshBasicMaterial({transparent: true, opacity: 0});
		door4 = new THREE.Mesh(geometry, material);
		door4.position.set(64.48676, 5.42511, 33.38983);
		door4.addBehaviors(altspace.utilities.behaviors.Object3DSync(), doorAction4() );
		door4UpSound = new NativeComponent('n-sound', {src: "DoorUp.ogg", oneshot: true, minDistance: 3}).addTo(door4);
		door4DownSound = new NativeComponent('n-sound', {src: "DoorDown.ogg", oneshot: true, minDistance: 3}).addTo(door4);
		sim.scene.add(door4);
		return(door4);
	};
	//DOOR 4 OBJ
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/door4.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.position.set(-64.48676, -5.42511, -33.38983);
		actualDoor4 = obj;
	});
	// DOOR 4 ACTION
	function doorAction4(){
		function awake(object3d){
		
			object3d.add(actualDoor4);
			var sync = object3d.getBehaviorByType('Object3DSync'); 
			
			direction4 = sync.dataRef.child("direction4");
			soundDown4 = sync.dataRef.child("soundDown4");
			soundUp4 = sync.dataRef.child("soundUp4");

			direction4.on("value", function(snapshot){
				direction4Val = snapshot.val();
				
				doorLoop();
				
				function doorLoop(){
					if (!direction4Val || direction4Val=="top" || direction4Val=="bottom")return;
					if(direction4Val == "up"){
						soundDown4.set("stopped");
						door4DownSound.call("stop");
						soundUp4.on("value", function(snap){soundUp4Val = snap.val()});
						if(soundUp4Val == "stopped" || !soundUp4Val){
							door4UpSound.call("play");
							soundUp4.set("playing");
						};
						door4.position.y += 0.05;
						if(door4.position.y >= 7.62511){
							soundUp4.set("stopped");
							direction4.set("top");
							return;
						};
					};
					
					if(direction4Val == "down"){
						soundUp4.set("stopped");
						door4UpSound.call("stop");
						soundDown4.on("value", function(snap){soundDown4Val = snap.val()});
						if(soundDown4Val == "stopped"){
							door4DownSound.call("play"); 
							soundDown4.set("playing");
						};
						door4.position.y -= 0.05;
						if(door4.position.y <= 5.47511){
							soundDown4.set("stopped");
							direction4.set("bottom");
							return;
						};
						
					};
					requestAnimationFrame(doorLoop);
				};
			});
			
			object3d.addEventListener("cursordown", function(){
				if(direction4Val == "up" ||direction4Val == "top"){
					direction4.set("down");
				}else if(!direction4Val || direction4Val == "down" || direction4Val == "bottom"){
					direction4.set("up");
				};
			});
		};
		
		return {awake: awake};
	};
	
	// COLLISION RAMPS
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/ramps.obj", function(obj){
		var collider = new NativeComponent('n-mesh-collider', {type: "environment", convex: false}, obj);
		obj.traverse(function(child){
		child.userData.altspace = {collider:{enabled: true}};
		});
		obj.children[0].material.opacity = 0;
		obj.children[0].material.transparent = true;
		sim.scene.add(obj);
	});
	
	// TRANSPARENT WALL
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/wall.obj", function(obj){
		obj.traverse(function(child){
			child.userData.altspace = {collider:{enabled: true}};
		});
		obj.children[0].material.opacity = 0.9;
		obj.children[0].material.transparent = true;
		obj.children[0].material.color = new THREE.Color(192/256, 192/256, 192/256);
		sim.scene.add(obj);
	});
	
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/e1m1/COLUA0.png", function(texture){
		var geometry = new THREE.PlaneGeometry(0.92, 1.92);
		var material = new THREE.MeshBasicMaterial({map: texture, transparent: true, opacity: 1, side: THREE.DoubleSide});
		lamp1 = new THREE.Mesh(geometry, material);
		lamp1.scale.multiplyScalar(0.80);
		lamp2 = new THREE.Mesh;
		lamp2 = lamp1.clone();
		lamp3 = new THREE.Mesh;
		lamp3 = lamp1.clone();
		lamp4 = new THREE.Mesh;
		lamp4 = lamp1.clone();
		lamp5 = new THREE.Mesh;
		lamp5 = lamp1.clone();
		lamp6 = new THREE.Mesh;
		lamp6 = lamp1.clone();
		lamp7 = new THREE.Mesh;
		lamp7 = lamp1.clone();
		lamp8 = new THREE.Mesh;
		lamp8 = lamp1.clone();
		lamp1.position.set(-17.48202 , 5.528, -15.89706);
		lamp2.position.set(-17.48202 , 5.528, -10.3725);
		lamp3.position.set(57.81093 , 5, -19.58708);
		lamp4.position.set(72.18862 , 5, -19.58708);
		lamp5.position.set(60.93755 , 5, 17.91993);
		lamp6.position.set(68.01082 , 5, 17.91993);
		lamp7.position.set(54.67568 , 5, 23.95352);
		lamp8.position.set(74.26427 , 5, 23.95352);
		var lamp1Board = new NativeComponent('n-billboard', null, lamp1).addTo(root);
		var lamp2Board = new NativeComponent('n-billboard', null, lamp2).addTo(root);
		var lamp3Board = new NativeComponent('n-billboard', null, lamp3).addTo(root);
		var lamp4Board = new NativeComponent('n-billboard', null, lamp4).addTo(root);
		var lamp5Board = new NativeComponent('n-billboard', null, lamp5).addTo(root);
		var lamp6Board = new NativeComponent('n-billboard', null, lamp6).addTo(root);
		var lamp7Board = new NativeComponent('n-billboard', null, lamp7).addTo(root);
		var lamp8Board = new NativeComponent('n-billboard', null, lamp8).addTo(root);
	});
	
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/e1m1/ELECA0.png", function(texture){
		var geometry = new THREE.PlaneGeometry(1.52, 5.12);
		var material = new THREE.MeshBasicMaterial({map: texture, transparent: true, opacity: 1, side: THREE.DoubleSide});
		column1 = new THREE.Mesh(geometry, material);
		column1.scale.multiplyScalar(0.90);
		column2 = new THREE.Mesh;
		column2 = column1.clone();
		column1.position.set(-25.37073 ,8.6, -17.3527);
		column2.position.set(-25.37073 ,8.6, -8.89570);
		var column1Board = new NativeComponent('n-billboard', null, column1).addTo(root);
		var column2Board = new NativeComponent('n-billboard', null, column2).addTo(root);
	});
	
	UltimateLoader.load("https://rawgit.com/evil-doer/evil-doer.github.io/master/models/e1m1/CBRAA0.png", function(texture){
		var geometry = new THREE.PlaneGeometry(1.16, 2.44);
		var material = new THREE.MeshBasicMaterial({map: texture, transparent: true, opacity: 1, side: THREE.DoubleSide});
		candelabra1 = new THREE.Mesh(geometry, material);
		candelabra1.scale.multiplyScalar(0.80);
		candelabra2 = new THREE.Mesh;
		candelabra2 = candelabra1.clone();
		candelabra1.position.set(61.81361 ,5.2, 29.73551);
		candelabra2.position.set(67.1118 ,5.2, 29.73551);
		var candelabra1Board = new NativeComponent('n-billboard', null, candelabra1).addTo(root);
		var candelabra2Board = new NativeComponent('n-billboard', null, candelabra2).addTo(root);
	});
	
	
	(function animateYet(){
		THREE.DefaultLoadingManager.onProgress = function(item, loaded, total){
			if(loaded == total){
				sim.scene.remove(elevator);
				animate();
				return;
			};
		};
		requestAnimationFrame(animateYet);
	})();
	
	//ANIMATION LOOP
	function animate(){
		requestAnimationFrame(animate);

		spinnyThing.map.offset.x += 0.005;
		
		curTime = new Date().getTime();
		glowState = 0.75+0.25*Math.cos(angle += .1);
		
		column1.material.color = new THREE.Color(glowState, glowState, glowState);
		column2.material.color = new THREE.Color(glowState, glowState, glowState);
		
		leftColFloor.color = new THREE.Color(glowState, glowState, glowState);
		leftColCeiling.color = new THREE.Color(glowState, glowState, glowState);
		rightColFloor.color = new THREE.Color(glowState, glowState, glowState);
		rightColCeiling.color = new THREE.Color(glowState, glowState, glowState);

		if(String(curTime).charAt(10) == "0"){
			endGlowFloor.color = new THREE.Color(1, 1, 1);
			endGlowWalls.color = new THREE.Color(1, 1, 1);
			endGlowCeiling.color = new THREE.Color(1, 1, 1);
			fence.color = new THREE.Color(1, 1, 1);
		
		}else{
			endGlowFloor.color = new THREE.Color(0.5, 0.5, 0.5);
			endGlowWalls.color = new THREE.Color(0.5, 0.5, 0.5);
			endGlowCeiling.color = new THREE.Color(0.5, 0.5, 0.5);
			fence.color = new THREE.Color(0.5, 0.5, 0.5);
		};
		
		if(String(curTime).charAt(12) == "0"){
			spawnFloor.color = new THREE.Color(1, 1, 1);
			spawnWalls.color = new THREE.Color(1, 1, 1);
			spawnDoor.color = new THREE.Color(1, 1, 1);
			spawnCeiling.color = new THREE.Color(1, 1, 1);
		}else{
			spawnFloor.color = new THREE.Color(0.5625, 0.5625, 0.5625);
			spawnWalls.color = new THREE.Color(0.5625, 0.5625, 0.5625);
			spawnDoor.color = new THREE.Color(0.5625, 0.5625, 0.5625);
			spawnCeiling.color = new THREE.Color(0.5625, 0.5625, 0.5625);
	
		};
		
		if(frame==1){
			slime.children[0].material.map.offset.x = 0;
			if(curTime > timer + 300){
				timer = curTime;
				frame = 2;
			};
		}else if(frame==2){
			slime.children[0].material.map.offset.x = 1/3;
			if(curTime > timer + 300){
				timer = curTime;
				frame = 3;
			};
		}else if(frame==3){
			slime.children[0].material.map.offset.x = 2/3;
			if(curTime > timer + 300){
				timer = curTime;
				frame = 1;
			};
		};
		//sim.scene.scale.set(3+2*Math.cos(angle2 += 0.005), 1, 3+2*Math.cos(angle2));
	};
};

</script></body></html>